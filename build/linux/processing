#!/bin/sh

# This script runs Processing, using the JRE in the Processing 
# installation directory.

# If your system needs a different version of Java than what's included
# in the download, replace the 'java' folder with the contents of a new
# Oracle JRE (Java 8 only), or create a symlink named "java" in the 
# Processing installation directory that points to the JRE home directory.
# This must be a Sun/Oracle JDK. For more details, see here:
# https://github.com/processing/processing/wiki/Supported-Platforms

# Thanks to Ferdinand Kasper for this build script. [fry]

# Get absolute path of directory where this script is located
APPDIR=`readlink -f -- "$0"`
APPDIR=`dirname "$APPDIR"`

# Try using a local JDK from the same directory as this script
JDKDIR=`readlink -f -- "$APPDIR/java"`

# Add all required JARs to CLASSPATH
CLASSPATH="$CLASSPATH"${CLASSPATH:+:}"$APPDIR/lib/*"
CLASSPATH="$CLASSPATH"${CLASSPATH:+:}"$APPDIR/core/library/*"
CLASSPATH="$CLASSPATH"${CLASSPATH:+:}"$APPDIR/modes/java/mode/*"
export CLASSPATH

# Make all JDK binaries available in PATH
export PATH="$JDKDIR/bin":"$PATH"

current_name=`basename $0`

if [ $current_name = 'processing-java' ]
then
  java \
    -Djna.nosys=true \
    -Djava.ext.dirs="$APPDIR"/java/lib/ext \
    -Xmx256m \
    processing.mode.java.Commander \
    "$@"
  exit $?
else
  # Start Processing in the same directory as this script
  if [ "$1" ]; then
    SKETCH=`readlink -f -- "$1"`
  else
    SKETCH=
  fi
  cd "$APPDIR"

  java \
    -splash:lib/about-1x.png \
    -Djna.nosys=true \
    -Djava.ext.dirs="$APPDIR"/java/lib/ext \
    -Xmx256m \
    processing.app.Base \
    "$SKETCH" &
fi
